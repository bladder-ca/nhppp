<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="es">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sampling from Weibull processes • nhppp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sampling from Weibull processes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nhppp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Gompertz_processes.html">Sampling from Gompertz processes</a></li>
    <li><a class="dropdown-item" href="../articles/Log_linear_times.html">Sampling log-linear times</a></li>
    <li><a class="dropdown-item" href="../articles/Simple_des_model_cancer_natural_Hx.html">A simple discrete event simulation model of a cancer's natural history</a></li>
    <li><a class="dropdown-item" href="../articles/Weibull_processes.html">Sampling from Weibull processes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bladder-ca/nhppp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Sampling from Weibull processes</h1>
                        <h4 data-toc-skip class="author">TA
Trikalinos</h4>
            
            <h4 data-toc-skip class="date">2025-08-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bladder-ca/nhppp/blob/main/vignettes/Weibull_processes.Rmd" class="external-link"><code>vignettes/Weibull_processes.Rmd</code></a></small>
      <div class="d-none name"><code>Weibull_processes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simulation-description">Simulation description<a class="anchor" aria-label="anchor" href="#simulation-description"></a>
</h2>
<p>Assume a population of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><msup><mn>10</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">K = 10^{6}</annotation></semantics></math>
individuals indexed by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>K</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>:=</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">k \in [K] := \{ 1, \dots, K\}</annotation></semantics></math>.
We will sample events from Weibull processes over the age (time)
interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><msub><mi>T</mi><mrow><mi>k</mi><mn>0</mn></mrow></msub><mo>,</mo><msub><mi>T</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">[T_{k0}, T_{k1})</annotation></semantics></math>.
For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>k</mi><mn>0</mn></mrow></msub><annotation encoding="application/x-tex">T_{k0}</annotation></semantics></math>
may be the age in years when person
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
enters the simulation, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">T_{k1}</annotation></semantics></math>
the age in years when that person exits the simulation (e.g., dies from
an ‘other cause’). (In practice,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">T_{k1}</annotation></semantics></math>
would be obtained by separate point process.) Only some people will
develop clinical cancer over their simulated lifetime.</p>
<p>To fix a simulation scenario, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>k</mi><mn>0</mn></mrow></msub><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">T_{k0} = 20</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo>∼</mo><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>60</mn><mo>,</mo><mn>100</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">T_{k1} \sim U(60 , 100)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">U()</annotation></semantics></math>
is the uniform distribution.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>We will use <code>data.table</code>s – but the same analysis should
be obvious in base <code>R</code>. We will use functions from three more
packages, without loading them: The <code>tictoc()</code> package will
be used for a simple time comparison between the different ways one can
simulate this problem. The <code>stats</code> package is used to
generate normally and uniformly distributed samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bladder-ca.github.io/nhppp/">nhppp</a></span><span class="op">)</span></span></code></pre></div>
<p>Setup <code>pop</code>, the population <code>data.table</code>. The
person specific values T_{k0}$ and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">T_{k1}</annotation></semantics></math>
are variables in <code>pop</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span>,</span>
<span>    T0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="va">K</span><span class="op">)</span>,</span>
<span>    T1 <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">K</span>, min <span class="op">=</span> <span class="fl">60</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setindex</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">id</span><span class="op">)</span></span>
<span><span class="va">pop</span></span>
<span><span class="co">#&gt; Index: &lt;id&gt;</span></span>
<span><span class="co">#&gt;               id    T0       T1</span></span>
<span><span class="co">#&gt;            &lt;int&gt; &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:       1    20 95.12126</span></span>
<span><span class="co">#&gt;       2:       2    20 61.79684</span></span>
<span><span class="co">#&gt;       3:       3    20 99.27175</span></span>
<span><span class="co">#&gt;       4:       4    20 90.76692</span></span>
<span><span class="co">#&gt;       5:       5    20 61.40517</span></span>
<span><span class="co">#&gt;      ---                       </span></span>
<span><span class="co">#&gt;  999996:  999996    20 79.90306</span></span>
<span><span class="co">#&gt;  999997:  999997    20 92.23822</span></span>
<span><span class="co">#&gt;  999998:  999998    20 96.23102</span></span>
<span><span class="co">#&gt;  999999:  999999    20 67.21445</span></span>
<span><span class="co">#&gt; 1000000: 1000000    20 64.96352</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-weibull-process-functions">The Weibull Process functions<a class="anchor" aria-label="anchor" href="#the-weibull-process-functions"></a>
</h2>
<p>The Weibull intensity function is</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><msub><mi>α</mi><mi>k</mi></msub><msub><mi>σ</mi><mi>k</mi></msub></mfrac><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><mfrac><mi>t</mi><msub><mi>σ</mi><mi>k</mi></msub></mfrac><msup><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo><mrow><msub><mi>α</mi><mi>k</mi></msub><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\lambda_k(t) = \frac{\alpha_k}{\sigma_k} \big(\frac{t}{\sigma_k}\big)^{\alpha_k-1}</annotation></semantics></math>,</p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is age in years. The parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_k, \sigma_k</annotation></semantics></math>
are random over the individuals in the population with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>k</mi></msub><mo>∼</mo><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2.28</mn><mo>,</mo><mn>3.28</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha_k \sim U(2.28, 3.28)</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>k</mi></msub><mo>∼</mo><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>64</mn><mo>,</mo><mn>84</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_k \sim U(64, 84)</annotation></semantics></math>.</p>
<p>Add these values as person-level parameters in the dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>  alpha_weibull <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">K</span>, min <span class="op">=</span> <span class="fl">2.28</span>, max <span class="op">=</span> <span class="fl">3.28</span><span class="op">)</span>,</span>
<span>  sigma_weibull <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">K</span>, min <span class="op">=</span> <span class="fl">64</span>, max <span class="op">=</span> <span class="fl">84</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>A cumulative intensity function is</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Λ</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><mfrac><mi>t</mi><msub><mi>σ</mi><mi>k</mi></msub></mfrac><msup><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo><msub><mi>α</mi><mi>k</mi></msub></msup></mrow><annotation encoding="application/x-tex">\Lambda_k(t) = \big(\frac{t}{\sigma_k}\big)^{\alpha_k}</annotation></semantics></math>,</p>
<p>with the integration constant arbitrarily set so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\Lambda(0) = 0</annotation></semantics></math>,
and its inverse is</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>σ</mi><mi>k</mi></msub><mspace width="0.222em"></mspace><msup><mi>z</mi><mrow><mn>1</mn><mi>/</mi><mi>α</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\Lambda^{-1}(z) = \sigma_k \ z^{1/\alpha}</annotation></semantics></math>.</p>
<div class="section level4">
<h4 id="vectorized-specification-of-the-weibull-lambda-lambda-and-lambda-1">Vectorized specification of the Weibull
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda()</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda()</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda^{-1}()</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#vectorized-specification-of-the-weibull-lambda-lambda-and-lambda-1"></a>
</h4>
<p>Define vectorized forms of the Weibull
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda()</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda()</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda^{-1}()</annotation></semantics></math>
functions that take as default the values in <code>pop</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l_weibull</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">alpha_weibull</span>, <span class="va">sigma</span> <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">sigma_weibull</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">alpha</span><span class="op">/</span><span class="va">sigma</span> <span class="op">*</span> <span class="op">(</span><span class="va">t</span><span class="op">/</span><span class="va">sigma</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">alpha</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">L_weibull</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">alpha_weibull</span>, <span class="va">sigma</span> <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">sigma_weibull</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">t</span><span class="op">/</span><span class="va">sigma</span><span class="op">)</span><span class="op">^</span><span class="va">alpha</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Li_weibull</span><span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">alpha_weibull</span>, <span class="va">sigma</span> <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">sigma_weibull</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sigma</span> <span class="op">*</span> <span class="va">z</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">alpha</span><span class="op">)</span></span>
<span><span class="op">}</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-1-vectorized-sampling-using-only-lambda">Method 1: Vectorized sampling using only
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda()</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#method-1-vectorized-sampling-using-only-lambda"></a>
</h3>
<p>When you only know the intensity function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>,
<code>nhppp</code> employs a thinning algorithm.</p>
<p>One of the items needed for the thinning algorithm is a piecewise
constant majorizer function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mo>*</mo></msub><annotation encoding="application/x-tex">\lambda_*</annotation></semantics></math>
such that:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mo>*</mo></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mo>=</mo><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda_*(t) &gt;= \lambda(t)</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
of interest.</p>
<p>The <code><a href="../reference/vdraw_intensity.html">nhppp::vdraw_intensity</a></code> function assumes that you
will provide the majorizer function as a matrix
(<code>lambda_maj_matrix</code>). To create this matrix, split the
simulation time (here, from age 40 to age 100) in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
equal-length intervals. For person
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
and interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>,
the element <code>lambda_maj_matrix[k, m]</code> records a supremum of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\lambda_k</annotation></semantics></math>
over the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>-th
interval. Any supremum will do – but the algorithm is most efficient
when you give it the least upper bound – practically, the maximum of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda(t)</annotation></semantics></math>
over all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
in the interval. For monotone intensity functions, such as the Weibull,
the maximum is at one of the interval’s bounds. It will be at the left
bound, if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is decreasing, and at the right bound, if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is increasing.</p>
<p>There is a helper function in <code>nhppp</code> that generates the
majorizer matrix automatically for monotone (and possibly discontinuous)
functions and for nonmonotone continuous Lipschitz functions (functions
whose maximum slope is bounded). Even if your case is more complex, you
should be able to find a supremum that works.</p>
<p>This code samples in a vectorized fashion when you know only
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda()</annotation></semantics></math>.
It creates a majorizer matrix over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">M=5</annotation></semantics></math>
intervals (we chose this arbitrarily – not trying to be fast). To let
the software know which times correspond to each of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
intervals it suffices to specify a start and stop time for each row of
the majorizer matrix with the <code>rate_matrix_t_min</code> and
<code>rate_matrix_t_max</code> options. The sampling intervals
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><msub><mi>T</mi><mrow><mi>k</mi><mn>0</mn></mrow></msub><mo>,</mo><msub><mi>T</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">[T_{k0}, T_{k1})</annotation></semantics></math>for
each simulated person are a subset of the interval for which the
majorizer matrix is defined, and are specified with the
<code>t_min</code> and <code>t_max</code> options. (The
<code>atmostB</code> option can be useful to speed up the sampling and
minimize memory needs when one is interested in the first event only.
The smaller the value, the faster the algorithm but you have to check
that you have not specified it to be too small. In this example,
<code>atmostB = 5</code> is fine – it returns exact solutions; but we
have checked it [not shown]. If you do not want to mess with it, do not
use the option. The function may be already fast enough for your
needs).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="st">"Method 1 (vectorized, thinning)"</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">break_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">20</span>, to <span class="op">=</span> <span class="fl">100</span>, length.out <span class="op">=</span> <span class="va">M</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">breaks_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">break_points</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">K</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lmaj_mat</span> <span class="op">&lt;-</span> <span class="fu">nhppp</span><span class="fu">::</span><span class="fu"><a href="../reference/get_step_majorizer.html">get_step_majorizer</a></span><span class="op">(</span></span>
<span>  fun <span class="op">=</span> <span class="va">l_weibull</span>,</span>
<span>  breaks <span class="op">=</span> <span class="va">breaks_mat</span>,</span>
<span>  is_monotone <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pop</span><span class="op">[</span></span>
<span>  ,</span>
<span>  <span class="va">t_thinning</span> <span class="op">:=</span> <span class="fu">nhppp</span><span class="fu">::</span><span class="fu"><a href="../reference/vdraw_intensity.html">vdraw_intensity</a></span><span class="op">(</span></span>
<span>    lambda <span class="op">=</span> <span class="va">l_weibull</span>,</span>
<span>    lambda_maj_matrix <span class="op">=</span> <span class="va">lmaj_mat</span>,</span>
<span>    rate_matrix_t_min <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    rate_matrix_t_max <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    t_min <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">T0</span>,</span>
<span>    t_max <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">T1</span>,</span>
<span>    atmost1 <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    atmostB <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span>log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># timer end</span></span>
<span><span class="co">#&gt; Method 1 (vectorized, thinning): 1.158 sec elapsed</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-2-vectorized-sampling-using-lambda-and-lambda-1">Method 2: Vectorized sampling using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda()</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda^{-1}()</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#method-2-vectorized-sampling-using-lambda-and-lambda-1"></a>
</h3>
<p>The most efficient sampling is possible when one knows
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda()</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Lambda^{-1}()</annotation></semantics></math>.
The <code>nhppp</code> package can sample in this case using the
<code><a href="../reference/vdraw_cumulative_intensity.html">vdraw_cumulative_intensity()</a></code> function. Here
<code>range_t</code> is a matrix with information on each person’s
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><msub><mi>T</mi><mrow><mi>k</mi><mn>0</mn></mrow></msub><mo>,</mo><msub><mi>T</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">[T_{k0}, T_{k1})</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="st">"Method 2 (vectorized, inversion)"</span><span class="op">)</span></span>
<span><span class="va">pop</span><span class="op">[</span></span>
<span>  ,</span>
<span>  <span class="va">t_inversion</span> <span class="op">:=</span> <span class="fu">nhppp</span><span class="fu">::</span><span class="fu"><a href="../reference/vdraw_cumulative_intensity.html">vdraw_cumulative_intensity</a></span><span class="op">(</span></span>
<span>    Lambda <span class="op">=</span> <span class="va">L_weibull</span>,</span>
<span>    Lambda_inv <span class="op">=</span> <span class="va">Li_weibull</span>,</span>
<span>    t_min <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">T0</span>,</span>
<span>    t_max <span class="op">=</span> <span class="va">pop</span><span class="op">$</span><span class="va">T1</span>,</span>
<span>    atmost1 <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span>log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># timer end</span></span>
<span><span class="co">#&gt; Method 2 (vectorized, inversion): 0.12 sec elapsed</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparisons">Comparisons<a class="anchor" aria-label="anchor" href="#comparisons"></a>
</h3>
<div class="section level4">
<h4 id="simulation-time-costs">Simulation time-costs<a class="anchor" aria-label="anchor" href="#simulation-time-costs"></a>
</h4>
<p>The simulation time-costs that you see in this document depend on the
machine that rendered it. If you read this online, this machine is
probably some virtual server with minimal resources. If you installed
the package locally, it is probably the machine you are using to run
<code>R</code>.</p>
<ol style="list-style-type: decimal">
<li><p>Method 1 (vectorized, thinning): 1.158 sec elapsed. This is the
slower approach – but still not bad for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mn>6</mn></msup><annotation encoding="application/x-tex">10^{6}</annotation></semantics></math>
samples! It uses the thinning algorithm which is very flexible – it can
accommodate very complex time varying intensity functions. You almost
always know
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
and can get its majorizer
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mo>*</mo></msub><annotation encoding="application/x-tex">\lambda_*</annotation></semantics></math>
easily and fast.</p></li>
<li><p>Method 2 (vectorized, inversion): 0.12 sec elapsed. This approach
is many times faster that the previous one, but requires implementations
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Λ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">\Lambda^{-1}</annotation></semantics></math>.</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="simulated-times">Simulated times<a class="anchor" aria-label="anchor" href="#simulated-times"></a>
</h3>
<p>Both methods sample correctly from the specified log-linear process.
There is no approximation at play.</p>
<p>The QQ plots compare the simulated times with the two methods. The
agreement is excellent over this population of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><msup><mn>10</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">K = 10^{6}</annotation></semantics></math>.
As
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
increases the agreement remains excellent (not shown here - try it for
yourself). The paper in the bibliography includes in-depth comparisons.
A set of QQ plots should suffice here.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqplot</a></span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">t_thinning</span>, <span class="va">pop</span><span class="op">$</span><span class="va">t_inversion</span><span class="op">)</span></span></code></pre></div>
<p><img src="Weibull_processes_files/figure-html/qq-plot-1.png" alt="QQ plot comparing simulated times with the two methods. The QQ plot indicates excellent agreement." width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<p>Thanks to Fernando Alarid-Escudero for providing the numerical
example in this vignette.</p>
</div>
<div class="section level2">
<h2 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<p>Trikalinos TA, Sereda Y. <em>nhppp: Simulating Nonhomogeneous Poisson
Point Processes in R</em>. arXiv preprint arXiv:2402.00358. 2024 Feb
1.</p>
<p>Trikalinos TA, Sereda Y. <em>The nhppp package for simulating
non-homogeneous Poisson point processes in R</em>. PLoS One. 2024 Nov
21;19(11):e0311311.</p>
<p>Marshall AW, Olkin I. “The Weibull distribution” (p 321 in <em>Life
distributions</em> Springer, New York; 2007.</p>
<p>Since the publication of the paper, the syntax and options of the
<code>nhppp</code> package have evolved. To reproduce the code in the
paper, you have to install the version of <code>nhppp</code> used in the
paper. Alternatively, take a look at the vignettes, which are written to
work with the current package.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Trikalinos, Yuliia Sereda.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
