
<!-- README.md is generated from README.Rmd. Please edit that file -->

# nhppp

<!-- badges: start -->

[![Codecov test
coverage](https://codecov.io/gh/bladder-ca/nhppp-fast/branch/main/graph/badge.svg)](https://app.codecov.io/gh/bladder-ca/nhppp-fast?branch=main)
<!-- badges: end -->

nhppp is a package for simulating events from one dimensional
nonhomogeneous Poisson point processes (NHPPPs). Its functions are based
on three algorithms that provably sample from a target NHPPP: the
time-transformation of a homogeneous Poisson process (of intensity one)
via the inverse of the integrated intensity function; the generation of
a Poisson number of order statistics from a fixed density function; and
the thinning of a majorizing NHPPP via an acceptance-rejection scheme.

## Installation

You can install the release version of nhppp from
[CRAN](https://cran.r-project.org) with:

``` r
install.packages("nhppp")
```

You can install the development version of nhppp from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("bladder-ca/nhppp-fast")
```

## Example

These examples use the generic function `draw()`, which is a wrapper for
the packages specific functions.

Consider the time varying intensity function
$\lambda(t) = e^{(0.2t)} (1 + \sin t)$, which is a sinusoidal intensity
function with an exponential amplitude. To draw samples over the
interval $(0, 6\pi]$ execute

``` r
l <- function(t) (1 + sin(t)) * exp(0.2 * t)
nhppp::draw(lambda = l, lambda_maj = l(6 * pi), range_t = c(0, 6 * pi))
#>   [1]  0.06079037  0.18107770  0.72560748  0.73542464  1.16423928  2.16087137
#>   [7]  2.49539973  6.17500609  6.59029587  6.67328152  6.87653760  6.87710852
#>  [13]  6.92719442  7.05561221  7.05882971  7.42624673  7.44355578  7.44862433
#>  [19]  7.74069702  7.77473108  8.21192634  8.36792144  8.37195182  8.43478122
#>  [25]  8.61075031  8.69114291  8.85124995  8.89323188  9.35276983  9.45439241
#>  [31]  9.76131359  9.91572857 10.12267293 10.16099297 10.35932342 11.55576380
#>  [37] 11.59006926 11.65451963 12.09759309 12.10584887 12.26932588 12.27079594
#>  [43] 12.53093070 12.56043888 12.59397853 12.62396199 12.66032847 12.74549084
#>  [49] 12.76921034 12.84472397 12.85155489 12.85913160 12.96933753 13.04855503
#>  [55] 13.05491034 13.14758156 13.15763990 13.17180055 13.17862534 13.19606009
#>  [61] 13.26489382 13.29715192 13.31648762 13.37551353 13.41304121 13.46337216
#>  [67] 13.48666121 13.56585900 13.56691460 13.58641461 13.59916042 13.62128346
#>  [73] 13.62486070 13.66757296 13.68045068 13.71249655 13.73926838 13.74215951
#>  [79] 13.77043443 13.86664950 13.87513656 13.91799268 13.93938179 13.96066049
#>  [85] 13.98787363 14.00337749 14.00954037 14.08709200 14.10410646 14.12080132
#>  [91] 14.12163719 14.17271817 14.18398236 14.23650375 14.27716296 14.29460544
#>  [97] 14.29619685 14.35478106 14.37769697 14.37954707 14.38360879 14.38820998
#> [103] 14.52682246 14.56354184 14.60622580 14.62046833 14.64980951 14.66337969
#> [109] 14.74008802 14.79013144 14.83104362 14.97775524 14.97991687 14.98410056
#> [115] 15.00508788 15.04070901 15.06955284 15.08634278 15.19284466 15.20385749
#> [121] 15.24544692 15.24758891 15.24965179 15.25347750 15.35985604 15.44631962
#> [127] 15.45091899 15.49521804 15.53012005 15.55580410 15.57930780 15.65505498
#> [133] 15.77734082 15.86524393 15.96623615 15.97750339 16.01477268 16.03439561
#> [139] 16.09704928 16.17536285 16.38540822 16.41424673 16.45372724 16.47697216
#> [145] 16.47720948 16.64097327 16.65053939 17.52193330 17.91564791 17.98026201
#> [151] 18.00543690 18.01579156 18.04552982 18.11507160 18.12170645 18.13412862
#> [157] 18.14812070 18.24167289 18.26773710 18.33098922 18.34953445 18.37147293
#> [163] 18.37269051 18.46054812 18.54150417 18.55964579 18.59708024 18.74313611
#> [169] 18.75138617 18.76171875 18.78811692 18.83446623
```

where `lambda_maj` is a majorizer constant.

When available, the integrated intensity function
$\Lambda(t) = \int_0^t \lambda(s) \ ds$ and itâ€™s inverse
$\Lambda^{-1}(z)$ result in faster simulation times. For this example,
$\Lambda(t) = \frac{e^{0.2t}(0.2 \sin t - \cos t)+1}{1.04} + \frac{e^{0.2t} - 1}{0.2}$;
$\Lambda^{-1}(z)$ is constructed numerically upfront (or can be
calculated numerically by the function, at a computational cost).

``` r
L <- function(t) {
  exp(0.2 * t) * (0.2 * sin(t) - cos(t)) / 1.04 +
    exp(0.2 * t) / 0.2 - 4.038462
}
Li <- stats::approxfun(x = L(seq(0, 6 * pi, 10^-3)), y = seq(0, 6 * pi, 10^-3), rule = 2)

nhppp::draw(Lambda = L, Lambda_inv = Li, range_t = c(0, 6 * pi))
#>   [1]  0.125538  1.010451  1.297903  1.902220  1.961084  2.649286  3.043487
#>   [8]  4.431286  5.654550  5.764047  5.861880  5.886258  6.293025  6.589508
#>  [15]  6.690932  6.722978  6.977806  7.095405  7.111171  7.228472  7.274216
#>  [22]  7.278789  7.646856  7.796526  7.835612  7.859682  7.914592  8.042178
#>  [29]  8.128719  8.199232  8.245156  8.255002  8.341775  8.413124  8.444842
#>  [36]  8.457740  8.486565  8.689565  8.705953  8.884324  8.972390  9.187674
#>  [43]  9.327830  9.607507  9.640186  9.826679 10.040981 10.306920 10.559311
#>  [50] 11.797620 12.496982 12.700749 12.756750 12.840495 12.878929 12.927385
#>  [57] 12.959900 13.034049 13.115064 13.166448 13.229868 13.279489 13.282299
#>  [64] 13.298302 13.328118 13.388582 13.416617 13.485583 13.487775 13.502024
#>  [71] 13.512322 13.512337 13.530235 13.705693 13.735544 13.810595 13.812327
#>  [78] 13.818164 13.821673 13.842473 13.878189 13.930855 13.977542 14.041108
#>  [85] 14.069826 14.094831 14.141438 14.155551 14.171215 14.184227 14.200761
#>  [92] 14.216414 14.226417 14.248116 14.266428 14.308326 14.311925 14.395564
#>  [99] 14.415698 14.436497 14.559280 14.595866 14.660223 14.703744 14.758359
#> [106] 14.759685 14.763521 14.838066 14.889193 14.934181 14.980642 15.078095
#> [113] 15.089243 15.095635 15.107326 15.122985 15.142442 15.172598 15.209930
#> [120] 15.270200 15.271073 15.299218 15.307797 15.316409 15.437032 15.445411
#> [127] 15.450169 15.452311 15.462949 15.463114 15.471875 15.471935 15.511947
#> [134] 15.599117 15.604022 15.623385 15.679174 15.791914 15.898706 15.907543
#> [141] 15.912118 15.953212 16.010395 16.013891 16.096452 16.254006 16.273364
#> [148] 16.506312 16.525951 16.659346 16.660794 16.711494 17.665451 17.848367
#> [155] 17.987230 18.004444 18.134993 18.316646 18.455772 18.554021 18.566591
#> [162] 18.568932 18.658939 18.664144 18.673220 18.675260 18.721260 18.725295
#> [169] 18.786575
```
