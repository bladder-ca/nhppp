
<!-- README.md is generated from README.Rmd. Please edit that file -->

# nhppp

<!-- badges: start -->

[![Codecov test
coverage](https://codecov.io/gh/bladder-ca/nhppp-fast/branch/main/graph/badge.svg)](https://app.codecov.io/gh/bladder-ca/nhppp-fast?branch=main)
[![R-CMD-check](https://github.com/bladder-ca/nhppp-fast/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/bladder-ca/nhppp-fast/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

nhppp is a package for simulating events from one dimensional
nonhomogeneous Poisson point processes (NHPPPs). Its functions are based
on three algorithms that provably sample from a target NHPPP: the
time-transformation of a homogeneous Poisson process (of intensity one)
via the inverse of the integrated intensity function; the generation of
a Poisson number of order statistics from a fixed density function; and
the thinning of a majorizing NHPPP via an acceptance-rejection scheme.

## Installation

You can install the release version of nhppp from
[CRAN](https://cran.r-project.org) with:

``` r
install.packages("nhppp")
```

You can install the development version of nhppp from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("bladder-ca/nhppp-fast")
```

## Example

These examples use the generic function `draw()`, which is a wrapper for
the packages specific functions.

Consider the time varying intensity function
$\lambda(t) = e^{(0.2t)} (1 + \sin t)$, which is a sinusoidal intensity
function with an exponential amplitude. To draw samples over the
interval $(0, 6\pi]$ execute

``` r
l <- function(t) (1 + sin(t)) * exp(0.2 * t)
nhppp::draw(lambda = l, lambda_maj = l(6 * pi), range_t = c(0, 6 * pi))
#>   [1]  1.040739  1.357244  1.609189  1.645886  1.846312  1.896139  2.508315
#>   [8]  2.862599  3.709696  5.316159  5.509402  5.611044  5.662823  5.683606
#>  [15]  5.719914  5.941843  5.947844  6.190499  6.226758  6.379196  6.554937
#>  [22]  6.706168  6.933617  6.997307  7.055160  7.291120  7.456281  7.476954
#>  [29]  7.486487  7.593241  7.743519  7.953805  8.112375  8.128084  8.191799
#>  [36]  8.215955  8.279809  8.475861  8.514204  8.535722  8.546026  8.553214
#>  [43]  8.659250  8.676673  8.723760  9.008598  9.049034  9.337573  9.495225
#>  [50]  9.797024  9.911206 10.180637 10.345225 11.934624 11.968970 11.988611
#>  [57] 12.488480 12.582872 12.639425 12.656878 12.657037 12.711202 12.716093
#>  [64] 12.765079 12.803310 12.907165 12.927060 13.074061 13.086377 13.109093
#>  [71] 13.135921 13.155489 13.159549 13.215045 13.250338 13.315647 13.343375
#>  [78] 13.347855 13.351435 13.393117 13.518065 13.561409 13.565996 13.584364
#>  [85] 13.650324 13.652785 13.724146 13.861509 13.869625 13.918628 13.969059
#>  [92] 13.972710 13.983131 14.021432 14.034572 14.075538 14.084775 14.094774
#>  [99] 14.158109 14.208099 14.210570 14.229023 14.250588 14.251848 14.284931
#> [106] 14.290386 14.305156 14.331067 14.351232 14.366987 14.400202 14.434115
#> [113] 14.443792 14.451624 14.491596 14.538985 14.548345 14.550260 14.558120
#> [120] 14.591302 14.591388 14.640643 14.675438 14.679472 14.710593 14.808820
#> [127] 14.850419 14.851338 14.876688 14.881086 14.932081 14.952992 14.977092
#> [134] 15.040347 15.082542 15.118427 15.122490 15.151949 15.167287 15.173761
#> [141] 15.189007 15.219435 15.297337 15.305932 15.327157 15.328531 15.360533
#> [148] 15.371015 15.473904 15.497307 15.577188 15.596228 15.641688 15.643905
#> [155] 15.701694 15.877478 15.944323 15.972259 16.013129 16.046822 16.427029
#> [162] 16.533221 18.085058 18.138570 18.284839 18.317226 18.420262 18.443964
#> [169] 18.496234 18.547401 18.551183 18.586954 18.594648 18.619862 18.626969
#> [176] 18.679845 18.751509 18.756164 18.778902 18.795936 18.806465 18.810828
#> [183] 18.849308
```

where `lambda_maj` is a majorizer constant.

When available, the integrated intensity function
$\Lambda(t) = \int_0^t \lambda(s) \ ds$ and itâ€™s inverse
$\Lambda^{-1}(z)$ result in faster simulation times. For this example,
$\Lambda(t) = \frac{e^{0.2t}(0.2 \sin t - \cos t)+1}{1.04} + \frac{e^{0.2t} - 1}{0.2}$;
$\Lambda^{-1}(z)$ is constructed numerically upfront (or can be
calculated numerically by the function, at a computational cost).

``` r
L <- function(t) {
  exp(0.2 * t) * (0.2 * sin(t) - cos(t)) / 1.04 +
    exp(0.2 * t) / 0.2 - 4.038462
}
Li <- stats::approxfun(x = L(seq(0, 6 * pi, 10^-3)), y = seq(0, 6 * pi, 10^-3), rule = 2)

nhppp::draw(Lambda = L, Lambda_inv = Li, range_t = c(0, 6 * pi))
#>   [1]  0.7120321  1.7647026  2.0004133  2.0072546  3.0510568  6.9521551
#>   [7]  7.0439715  7.2676310  7.3741564  7.4984389  7.7347524  7.9787822
#>  [13]  8.1363635  8.1895289  8.1942006  8.1959936  8.8888325  8.8970765
#>  [19]  8.9496187  8.9932723  9.0510246  9.0774120  9.0885412  9.4147791
#>  [25]  9.8035917  9.9653403 10.0468888 10.3481723 11.1841076 12.2070419
#>  [31] 12.4594141 12.4846310 12.5278756 12.5372796 12.6368394 12.6659434
#>  [37] 12.8086851 12.8437017 12.9069310 12.9593525 13.0341815 13.0525286
#>  [43] 13.1623259 13.2494670 13.3265048 13.3448019 13.3703400 13.4178064
#>  [49] 13.4218031 13.4795993 13.4990532 13.5065580 13.5309475 13.5450494
#>  [55] 13.5503624 13.5699012 13.6074912 13.6514972 13.7864148 13.8120218
#>  [61] 13.8142927 13.8487352 13.8489355 13.8595170 13.8949621 13.9029905
#>  [67] 13.9100721 13.9179605 13.9587262 13.9611549 14.0036755 14.0053460
#>  [73] 14.0232468 14.0557081 14.0692784 14.0708341 14.1124906 14.1196114
#>  [79] 14.1235117 14.2079846 14.2119339 14.2121013 14.2251503 14.2277772
#>  [85] 14.2756937 14.4362642 14.4776668 14.4830667 14.5758792 14.5908711
#>  [91] 14.6406416 14.6703474 14.6710574 14.6973463 14.7305057 14.7469893
#>  [97] 14.7538301 14.7852110 14.8577918 14.9196421 14.9249338 14.9453591
#> [103] 14.9698734 15.0218706 15.0374611 15.0529399 15.0717675 15.1038571
#> [109] 15.1601247 15.1628910 15.1774855 15.2920719 15.2995162 15.3080161
#> [115] 15.4752704 15.4798576 15.5492594 15.5709916 15.6184535 15.6269251
#> [121] 15.7394870 15.7717515 15.8339860 15.9175129 15.9271819 15.9841208
#> [127] 16.0062859 16.0675446 16.1122511 16.1996262 16.2836120 17.6697253
#> [133] 17.8083155 18.0701236 18.1040277 18.1765793 18.1808374 18.4192845
#> [139] 18.5277424 18.5306776 18.5841019 18.6272122 18.6374597 18.6473068
#> [145] 18.6637468 18.7507262 18.7794151 18.7925045 18.8036124 18.8053014
#> [151] 18.8153452 18.8212244 18.8239627 18.8274069 18.8475091
```
